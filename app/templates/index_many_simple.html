<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Transit by TEMPLATED</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="description" content="" />
  <meta name="keywords" content="" />
  <!--[if lte IE 8]><script src="js/html5shiv.js"></script><![endif]-->
  <script src="js/jquery.min.js"></script>
  <script src="js/skel.min.js"></script>
  <script src="js/skel-layers.min.js"></script>
  <script src="js/init.js"></script>
  <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
    integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
    crossorigin=""></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js" charset="utf-8"></script>
  <script src="https://cdn.plot.ly/plotly-latest.js" charset="utf-8"></script>
  <noscript>
    <link rel="stylesheet" href="css/skel.css" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/style-xlarge.css" />
  </noscript>
  <!-- LEAFLET -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
    integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
      crossorigin=""/>
    <!-- END LEAFLET -->
  </head>
  <body class="landing">
		<!-- One -->
    <section id="one" class="wrapper style1 special">
      <div class="container">
        <header class="major">
          <h2>Consectetur adipisicing elit</h2>
          <p>Lorem ipsum dolor sit amet, delectus consequatur, similique quia!</p>
        </header>
        <div class="row 150%">
          <div class="4u 12u$(medium)">
            <section class="box">
              <i class="icon big rounded color1 fa-cloud"></i>
              <h3>Lorem ipsum dolor</h3>
              <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Enim quam consectetur quibusdam magni minus aut modi aliquid.</p>
            </section>
          </div>
          <div class="4u 12u$(medium)">
            <section class="box">
              <i class="icon big rounded color9 fa-desktop"></i>
              <h3>Consectetur adipisicing</h3>
              <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Laudantium ullam consequatur repellat debitis maxime.</p>
            </section>
          </div>
          <div class="4u$ 12u$(medium)">
            <section class="box">
              <i class="icon big rounded color6 fa-rocket"></i>
              <h3>Adipisicing elit totam</h3>
              <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Atque eaque eveniet, nesciunt molestias. Ipsam, voluptate vero.</p>
            </section>
          </div>
        </div>
      </div>
    </section>
    <!-- LEAFLET -->
    <div id="mapid" style = "width:900px; height:580px; text-align: center; margin: 0;"></div>
    <!-- END LEAFLET -->
  </body>
</html>

<script>

////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////// MAP ANTENNES ///////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////


var antennes_data = [{"Antenna_Id":2,"x":601976.9827520001,"y":650184.426394},{"Antenna_Id":5,"x":599917.3147260001,"y":648764.937245},{"Antenna_Id":7,"x":600686.88189,"y":649109.477371},{"Antenna_Id":8,"x":600932.4705180001,"y":650159.525584},{"Antenna_Id":9,"x":601026.924381,"y":649883.108971},{"Antenna_Id":10,"x":600714.924071,"y":649097.22544},{"Antenna_Id":13,"x":601056.522961,"y":650771.103744},{"Antenna_Id":17,"x":600786.767062,"y":652138.9190090001},{"Antenna_Id":18,"x":601467.363592,"y":651430.7490109999},{"Antenna_Id":22,"x":600328.443771,"y":651159.539474},{"Antenna_Id":23,"x":600110.959703,"y":651829.085065},{"Antenna_Id":24,"x":600448.807269,"y":652805.61038},{"Antenna_Id":25,"x":600304.9615869999,"y":652144.200003},{"Antenna_Id":26,"x":600817.69322,"y":651882.7195529999},{"Antenna_Id":31,"x":600670.262893,"y":652848.002645},{"Antenna_Id":32,"x":600843.2335229999,"y":651348.733208},{"Antenna_Id":33,"x":600618.130692,"y":648927.299183},{"Antenna_Id":35,"x":600632.1856140001,"y":653157.6937770001},{"Antenna_Id":39,"x":601136.553094,"y":649742.96542},{"Antenna_Id":45,"x":600036.30377,"y":649088.9615409999},{"Antenna_Id":47,"x":601630.189365,"y":650100.212471},{"Antenna_Id":48,"x":601800.152556,"y":651091.3646720001},{"Antenna_Id":50,"x":600159.609128,"y":648858.18785},{"Antenna_Id":54,"x":600146.523181,"y":652559.518545},{"Antenna_Id":55,"x":601555.485445,"y":651270.085418},{"Antenna_Id":57,"x":601786.220382,"y":650015.7441380001},{"Antenna_Id":58,"x":601197.974211,"y":650615.12061},{"Antenna_Id":61,"x":600657.792821,"y":650385.5905350001},{"Antenna_Id":63,"x":600431.3578850001,"y":648956.498195},{"Antenna_Id":64,"x":600736.867391,"y":649689.33519},{"Antenna_Id":65,"x":600734.365886,"y":649605.735158},{"Antenna_Id":66,"x":600319.176858,"y":649061.334547},{"Antenna_Id":69,"x":601792.9283510001,"y":650162.402805},{"Antenna_Id":70,"x":602094.429551,"y":650171.355414},{"Antenna_Id":71,"x":600255.040228,"y":649027.91859},{"Antenna_Id":72,"x":599903.437672,"y":649510.837157},{"Antenna_Id":77,"x":600008.765087,"y":650833.277593},{"Antenna_Id":79,"x":600509.61435,"y":651407.6580279999},{"Antenna_Id":80,"x":600182.323101,"y":651253.894129},{"Antenna_Id":82,"x":600276.674052,"y":649522.8117899999},{"Antenna_Id":83,"x":601014.735105,"y":651455.013695},{"Antenna_Id":84,"x":601438.125247,"y":651750.5205710001},{"Antenna_Id":87,"x":599830.792487,"y":649473.40205},{"Antenna_Id":90,"x":600995.056948,"y":651143.702946},{"Antenna_Id":91,"x":599969.599013,"y":650739.991191},{"Antenna_Id":92,"x":600639.327129,"y":651244.19277},{"Antenna_Id":93,"x":600996.491407,"y":650002.2246590001},{"Antenna_Id":95,"x":601425.552067,"y":651021.580236},{"Antenna_Id":97,"x":600533.257962,"y":650393.9986810001},{"Antenna_Id":98,"x":600773.502104,"y":650132.389794},{"Antenna_Id":99,"x":600200.989607,"y":649159.34994},{"Antenna_Id":101,"x":600216.4621539999,"y":649458.409534},{"Antenna_Id":103,"x":600292.794358,"y":650705.705462},{"Antenna_Id":104,"x":600520.218761,"y":650877.7148600001},{"Antenna_Id":105,"x":600929.818494,"y":650939.2857060001},{"Antenna_Id":106,"x":601313.513827,"y":650261.67485},{"Antenna_Id":109,"x":600053.218578,"y":650014.605814},{"Antenna_Id":110,"x":600091.015093,"y":649791.594036},{"Antenna_Id":114,"x":600831.599683,"y":650572.7612290001},{"Antenna_Id":115,"x":600624.821241,"y":650886.69713},{"Antenna_Id":117,"x":600252.471518,"y":653516.0760220001},{"Antenna_Id":118,"x":600690.866696,"y":650267.436447},{"Antenna_Id":122,"x":601251.129995,"y":649924.072102},{"Antenna_Id":125,"x":600408.470275,"y":652231.456416},{"Antenna_Id":126,"x":601079.886094,"y":650268.3690439999},{"Antenna_Id":129,"x":600645.3265770001,"y":650255.798481},{"Antenna_Id":130,"x":600242.4295020001,"y":652408.177728},{"Antenna_Id":131,"x":601514.911596,"y":650068.348954},{"Antenna_Id":133,"x":601462.6948470001,"y":648964.107958},{"Antenna_Id":135,"x":601665.7913439999,"y":650966.764049},{"Antenna_Id":136,"x":600629.498658,"y":650014.343535},{"Antenna_Id":137,"x":600407.311058,"y":653211.244496},{"Antenna_Id":139,"x":601294.235493,"y":651938.6635319999},{"Antenna_Id":140,"x":600216.83407,"y":649653.335096},{"Antenna_Id":141,"x":601126.8775159999,"y":653538.7805840001},{"Antenna_Id":142,"x":600564.455101,"y":652729.315347},{"Antenna_Id":143,"x":600005.730261,"y":652093.23084},{"Antenna_Id":144,"x":600102.536634,"y":652381.6325290001},{"Antenna_Id":147,"x":600014.747555,"y":651529.208524},{"Antenna_Id":148,"x":600273.755739,"y":652995.73707},{"Antenna_Id":154,"x":601406.8874529999,"y":652061.047688},{"Antenna_Id":156,"x":602103.592967,"y":649742.183146},{"Antenna_Id":157,"x":601290.4317229999,"y":651600.434538},{"Antenna_Id":158,"x":601144.6187,"y":650585.8113569999},{"Antenna_Id":159,"x":601129.055069,"y":653193.9500760001},{"Antenna_Id":160,"x":601820.273318,"y":650417.124894},{"Antenna_Id":161,"x":600203.0787020001,"y":651730.08},{"Antenna_Id":162,"x":601816.5772619999,"y":651049.878332},{"Antenna_Id":166,"x":601428.150315,"y":650692.507349},{"Antenna_Id":169,"x":601976.283776,"y":650135.165896},{"Antenna_Id":170,"x":601625.469723,"y":650151.7530350001},{"Antenna_Id":171,"x":601474.697887,"y":650298.746395},{"Antenna_Id":175,"x":601159.1447470001,"y":650051.779337},{"Antenna_Id":176,"x":600658.07369,"y":652048.784732},{"Antenna_Id":177,"x":601162.302202,"y":652195.8456550001},{"Antenna_Id":179,"x":600329.10415,"y":651208.479851},{"Antenna_Id":180,"x":600901.5542819999,"y":651774.870814},{"Antenna_Id":181,"x":601444.1821689999,"y":651442.91114},{"Antenna_Id":187,"x":600272.3340609999,"y":650286.9238529999},{"Antenna_Id":188,"x":600598.953909,"y":649243.843553},{"Antenna_Id":193,"x":600977.8138850001,"y":650597.881726},{"Antenna_Id":194,"x":600384.426337,"y":650135.919067},{"Antenna_Id":197,"x":600660.717662,"y":651332.288618},{"Antenna_Id":198,"x":600672.480634,"y":649382.331698},{"Antenna_Id":199,"x":599970.87655,"y":651709.309596},{"Antenna_Id":200,"x":600131.509695,"y":651430.759772},{"Antenna_Id":201,"x":600410.273702,"y":650778.9884489999},{"Antenna_Id":202,"x":599954.78761,"y":649919.609747},{"Antenna_Id":207,"x":600939.502686,"y":648631.315721},{"Antenna_Id":209,"x":601559.302871,"y":649025.904768},{"Antenna_Id":212,"x":599767.764248,"y":650111.852675},{"Antenna_Id":213,"x":599821.0459029999,"y":650050.2202569999},{"Antenna_Id":214,"x":599990.2681859999,"y":650129.654307},{"Antenna_Id":216,"x":600558.143826,"y":652380.052969},{"Antenna_Id":219,"x":600554.5496340001,"y":648743.252808},{"Antenna_Id":221,"x":600203.682856,"y":649993.690708},{"Antenna_Id":225,"x":600171.327708,"y":650254.076033},{"Antenna_Id":226,"x":600167.568406,"y":650188.904467},{"Antenna_Id":227,"x":600995.281445,"y":652785.571876}]

let trace_antennes = {
  x: [],
  y: [],
  text : [],
  mode: "markers",
  name: 'Antennas',
  marker: {
  color: 'black',
  size: 6,
  symbol: 'star-triangle-up',
  hoverinfo: 'text',
}
};

antennes_data.forEach(function(val){
  trace_antennes.x.push(val["x"]/1000);
  trace_antennes.y.push(val["y"]/1000);
  trace_antennes.text.push(val["Antenna_Id"]);
});



////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////// MAP PEOPLE /////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////

var x_plot = [];
var y_plot = [];
var text_plot = [];

var trace = {
  x: [],
  y: [],
  mode: 'markers',
  type: 'scatter',
  marker: { size: 8,
            color : text_plot },
  name: 'People',
  hoverinfo: 'text',
};
var data = [trace]

var layout = {
  xaxis: {
    showticklabels: false,
    range: [599, 603]
  },
  yaxis: {
    showticklabels: false,
    range: [648, 654]
  },
  width: 1300,
  height: 800,
  title:'People moving around Madrid'
};

Plotly.newPlot('mapid', data, layout);

var interval = setInterval(function() {

  var update = {
    x: x_plot,
    y: y_plot,
    text : text_plot,
    mode: 'markers',
    type: 'scatter',
    hoverinfo: 'text',
    marker: { size: 8,
              color : text_plot },
    name: 'People' ,
  }

  Plotly.newPlot('mapid', [update,trace_antennes],layout)
  console.log(update)

}, 100);

var source = new EventSource("/topic/antennos");
source.addEventListener("message", function(e) {// console.log("message");
                                                  obj = JSON.parse(e.data);
                                                  //console.log(obj);
                                                  //  for (var i = 0; i < mapMarkers1.length; i++) {
                                                  //    map.removeLayer(mapMarkers1[i]);
                                                  //    } 
                                                  //marker1 = L.marker([obj.x, obj.y]).addTo(map);
                                                 // mapMarkers1.push(marker1);
                                                    x_plot = []
                                                    y_plot = []
                                                    text_plot = []
                                                    for (var i=0; i < obj.length; i++){
                                                      x_data = obj[i].x;
                                                      y_data = obj[i].y;
                                                      text_data = obj[i].PhoneId
                                                      x_plot.push(x_data);
                                                      y_plot.push(y_data);
                                                      text_plot.push(text_data);
                                                    }
                                                    
                                                    // x_data = obj.x;
                                                    // console.log(obj[0])
                                                    // console.log(obj.length)
                                                    // y_data = obj.y;
                                                    

                                                    
  }, false);
</script>